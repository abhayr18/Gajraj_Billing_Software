{"version":3,"sources":["../src/VisualEditsMessenger.tsx"],"sourcesContent":["// Next.js App Router directive: marks this as a Client Component\n// Required for components using React hooks and browser APIs\n// Harmless in other React frameworks (ignored as a string literal)\n\"use client\";\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, useState, useRef } from \"react\";\n\nexport const CHANNEL = \"ORCHIDS_HOVER_v1\" as const;\nconst VISUAL_EDIT_MODE_KEY = \"orchids_visual_edit_mode\" as const;\nconst FOCUSED_ELEMENT_KEY = \"orchids_focused_element\" as const;\n\n// Deduplicate helper for high-frequency traffic (HIT / FOCUS_MOVED / SCROLL)\n// -----------------------------------------------------------------------------\nlet _orchidsLastMsg = \"\";\nconst postMessageDedup = (data: any) => {\n  try {\n    const key = JSON.stringify(data);\n    if (key === _orchidsLastMsg) return; // identical – drop\n    _orchidsLastMsg = key;\n  } catch {\n    // if stringify fails, fall through\n  }\n  window.parent.postMessage(data, \"*\");\n};\n\nexport type ParentToChild =\n  | { type: typeof CHANNEL; msg: \"POINTER\"; x: number; y: number }\n  | { type: typeof CHANNEL; msg: \"VISUAL_EDIT_MODE\"; active: boolean }\n  | { type: typeof CHANNEL; msg: \"SCROLL\"; dx: number; dy: number }\n  | { type: typeof CHANNEL; msg: \"CLEAR_INLINE_STYLES\"; elementId: string }\n  | {\n      type: typeof CHANNEL;\n      msg: \"PREVIEW_FONT\";\n      elementId: string;\n      fontFamily: string;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"RESIZE_ELEMENT\";\n      elementId: string;\n      width: number;\n      height: number;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"SHOW_ELEMENT_HOVER\";\n      elementId: string | null;\n    };\n\nexport type ChildToParent =\n  | {\n      type: typeof CHANNEL;\n      msg: \"HIT\";\n      id: string | null;\n      tag: string | null;\n      rect: { top: number; left: number; width: number; height: number } | null;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"ELEMENT_CLICKED\";\n      id: string | null;\n      tag: string | null;\n      rect: { top: number; left: number; width: number; height: number };\n      clickPosition: { x: number; y: number };\n      isEditable?: boolean;\n      currentStyles?: {\n        fontSize?: string;\n        color?: string;\n        fontWeight?: string;\n        fontStyle?: string;\n        textDecoration?: string;\n        textAlign?: string;\n        lineHeight?: string;\n        letterSpacing?: string;\n        paddingLeft?: string;\n        paddingRight?: string;\n        paddingTop?: string;\n        paddingBottom?: string;\n        marginLeft?: string;\n        marginRight?: string;\n        marginTop?: string;\n        marginBottom?: string;\n        backgroundColor?: string;\n        backgroundImage?: string;\n        borderRadius?: string;\n        fontFamily?: string;\n        opacity?: string;\n        display?: string;\n        flexDirection?: string;\n        alignItems?: string;\n        justifyContent?: string;\n        gap?: string;\n      };\n      className?: string;\n      src?: string;\n    }\n  | { type: typeof CHANNEL; msg: \"SCROLL_STARTED\" }\n  | { type: typeof CHANNEL; msg: \"SCROLL_STOPPED\" }\n  | {\n      type: typeof CHANNEL;\n      msg: \"TEXT_CHANGED\";\n      id: string;\n      oldText: string;\n      newText: string;\n      filePath: string;\n      line: number;\n      column: number;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"STYLE_CHANGED\";\n      id: string;\n      styles: Record<string, string>;\n      filePath: string;\n      line: number;\n      column: number;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"STYLE_BLUR\";\n      id: string;\n      styles: Record<string, string>;\n      filePath: string;\n      line: number;\n      column: number;\n      className: string;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"IMAGE_BLUR\";\n      id: string;\n      oldSrc: string;\n      newSrc: string;\n      filePath: string;\n      line: number;\n      column: number;\n    }\n  | {\n      type: typeof CHANNEL;\n      msg: \"FOCUS_MOVED\";\n      id: string;\n      rect: { top: number; left: number; width: number; height: number };\n    }\n  | { type: typeof CHANNEL; msg: \"VISUAL_EDIT_MODE_ACK\"; active: boolean }\n  | { type: typeof CHANNEL; msg: \"VISUAL_EDIT_MODE_RESTORED\"; active: boolean };\n\ntype Box = null | { top: number; left: number; width: number; height: number };\n\nconst BOX_PADDING = 4; // Pixels to expand the box on each side\n\n// Helper to check if element can be made contentEditable\nconst isTextEditable = (element: HTMLElement): boolean => {\n  const tagName = element.tagName.toLowerCase();\n  // Elements that typically contain text and can be made contentEditable\n  const editableTags = [\n    \"p\",\n    \"h1\",\n    \"h2\",\n    \"h3\",\n    \"h4\",\n    \"h5\",\n    \"h6\",\n    \"span\",\n    \"div\",\n    \"li\",\n    \"td\",\n    \"th\",\n    \"label\",\n    \"a\",\n    \"button\",\n  ];\n\n  // Check if it's already contentEditable or an input/textarea\n  if (\n    element.contentEditable === \"true\" ||\n    tagName === \"input\" ||\n    tagName === \"textarea\"\n  ) {\n    return true;\n  }\n\n  // Allow editing if element contains text and is an editable tag\n  // Only allow editing if element has at most 1 child OR has direct text content\n  if (editableTags.includes(tagName) && element.textContent?.trim()) {\n    // Check if element has direct text nodes (not just text from children)\n    const hasDirectText = Array.from(element.childNodes).some(\n      (node) => node.nodeType === Node.TEXT_NODE && node.textContent?.trim()\n    );\n\n    // Allow editing if:\n    // 1. Element has no children (pure text element)\n    // 2. Element has 1 or fewer children AND has direct text content\n    if (\n      element.childElementCount === 0 ||\n      (element.childElementCount <= 1 && hasDirectText)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\n// Helper to extract only text nodes from an element (excluding child element text)\nconst extractDirectTextContent = (element: HTMLElement): string => {\n  let text = \"\";\n  for (const node of element.childNodes) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      text += node.textContent || \"\";\n    }\n  }\n  return text;\n};\n\n// Helper to parse data-orchids-id to extract file path, line, and column\nconst parseOrchidsId = (\n  orchidsId: string\n): { filePath: string; line: number; column: number } | null => {\n  // Format: \"filepath:line:column\"\n  const parts = orchidsId.split(\":\");\n  if (parts.length < 3) return null;\n\n  // The file path might contain colons, so we need to handle that\n  const column = parseInt(parts.pop() || \"0\");\n  const line = parseInt(parts.pop() || \"0\");\n  const filePath = parts.join(\":\"); // Rejoin the remaining parts as the file path\n\n  if (isNaN(line) || isNaN(column)) return null;\n\n  return { filePath, line, column };\n};\n\n// Helper to get current styles of an element (including inline styles)\nconst getCurrentStyles = (\n  element: HTMLElement\n): {\n  fontSize?: string;\n  color?: string;\n  fontWeight?: string;\n  fontStyle?: string;\n  textDecoration?: string;\n  textAlign?: string;\n  lineHeight?: string;\n  letterSpacing?: string;\n  paddingLeft?: string;\n  paddingRight?: string;\n  paddingTop?: string;\n  paddingBottom?: string;\n  marginLeft?: string;\n  marginRight?: string;\n  marginTop?: string;\n  marginBottom?: string;\n  backgroundColor?: string;\n  backgroundImage?: string;\n  borderRadius?: string;\n  fontFamily?: string;\n  opacity?: string;\n  display?: string;\n  flexDirection?: string;\n  alignItems?: string;\n  justifyContent?: string;\n  gap?: string;\n} => {\n  const computed = window.getComputedStyle(element);\n\n  // Helper to normalize values and provide defaults\n  const normalizeValue = (value: string, property: string): string => {\n    // Handle background color - if it's transparent or rgba(0,0,0,0), return \"transparent\"\n    if (property === \"backgroundColor\") {\n      if (\n        value === \"rgba(0, 0, 0, 0)\" ||\n        value === \"rgb(0, 0, 0, 0)\" ||\n        value === \"transparent\" ||\n        value === \"\"\n      ) {\n        return \"transparent\";\n      }\n    }\n\n    // Handle background image - if none, return \"none\"\n    if (property === \"backgroundImage\" && (value === \"none\" || value === \"\")) {\n      return \"none\";\n    }\n\n    // Handle text decoration - if none, return \"none\"\n    if (property === \"textDecoration\") {\n      // Some browsers return complex values like \"none solid rgb(0, 0, 0)\"\n      if (value.includes(\"none\") || value === \"\") {\n        return \"none\";\n      }\n    }\n\n    // Handle font style - if normal, return \"normal\"\n    if (property === \"fontStyle\" && (value === \"normal\" || value === \"\")) {\n      return \"normal\";\n    }\n\n    // Handle font weight - normalize to standard values\n    if (property === \"fontWeight\") {\n      const weight = parseInt(value);\n      if (!isNaN(weight)) {\n        return String(weight);\n      }\n      return value || \"400\";\n    }\n\n    // Handle opacity - if 1, return \"1\"\n    if (property === \"opacity\" && (value === \"1\" || value === \"\")) {\n      return \"1\";\n    }\n\n    // Handle spacing values (padding/margin) - if 0px, return \"0\"\n    if (\n      (property.includes(\"padding\") || property.includes(\"margin\")) &&\n      (value === \"0px\" || value === \"0\")\n    ) {\n      return \"0\";\n    }\n\n    // Handle border radius - if 0px, return \"0\"\n    if (property === \"borderRadius\" && (value === \"0px\" || value === \"0\")) {\n      return \"0\";\n    }\n\n    // Handle letter spacing - if normal, return \"normal\"\n    if (\n      property === \"letterSpacing\" &&\n      (value === \"normal\" || value === \"0px\")\n    ) {\n      return \"normal\";\n    }\n\n    // Handle gap - if normal, return \"normal\"\n    if (property === \"gap\" && (value === \"normal\" || value === \"0px\")) {\n      return \"normal\";\n    }\n\n    return value;\n  };\n\n  return {\n    fontSize: normalizeValue(computed.fontSize, \"fontSize\"),\n    color: normalizeValue(computed.color, \"color\"),\n    fontWeight: normalizeValue(computed.fontWeight, \"fontWeight\"),\n    fontStyle: normalizeValue(computed.fontStyle, \"fontStyle\"),\n    textDecoration: normalizeValue(computed.textDecoration, \"textDecoration\"),\n    textAlign: normalizeValue(computed.textAlign, \"textAlign\"),\n    lineHeight: normalizeValue(computed.lineHeight, \"lineHeight\"),\n    letterSpacing: normalizeValue(computed.letterSpacing, \"letterSpacing\"),\n    paddingLeft: normalizeValue(computed.paddingLeft, \"paddingLeft\"),\n    paddingRight: normalizeValue(computed.paddingRight, \"paddingRight\"),\n    paddingTop: normalizeValue(computed.paddingTop, \"paddingTop\"),\n    paddingBottom: normalizeValue(computed.paddingBottom, \"paddingBottom\"),\n    marginLeft: normalizeValue(computed.marginLeft, \"marginLeft\"),\n    marginRight: normalizeValue(computed.marginRight, \"marginRight\"),\n    marginTop: normalizeValue(computed.marginTop, \"marginTop\"),\n    marginBottom: normalizeValue(computed.marginBottom, \"marginBottom\"),\n    backgroundColor: normalizeValue(\n      computed.backgroundColor,\n      \"backgroundColor\"\n    ),\n    backgroundImage: normalizeValue(\n      computed.backgroundImage,\n      \"backgroundImage\"\n    ),\n    borderRadius: normalizeValue(computed.borderRadius, \"borderRadius\"),\n    fontFamily: normalizeValue(computed.fontFamily, \"fontFamily\"),\n    opacity: normalizeValue(computed.opacity, \"opacity\"),\n    display: normalizeValue(computed.display, \"display\"),\n    flexDirection: normalizeValue(computed.flexDirection, \"flexDirection\"),\n    alignItems: normalizeValue(computed.alignItems, \"alignItems\"),\n    justifyContent: normalizeValue(computed.justifyContent, \"justifyContent\"),\n    gap: normalizeValue(computed.gap, \"gap\"),\n  };\n};\n\n// Normalize image src for comparison (handles Next.js optimization wrappers)\nconst normalizeImageSrc = (input: string): string => {\n  if (!input) return \"\";\n  try {\n    const url = new URL(input, window.location.origin);\n    // Handle Next.js <Image> optimization wrapper\n    if (url.pathname === \"/_next/image\") {\n      const real = url.searchParams.get(\"url\");\n      if (real) return decodeURIComponent(real);\n    }\n    return url.href; // absolute form\n  } catch {\n    return input;\n  }\n};\n\n// Helper to wrap multiline text only when it contains line breaks\nconst wrapMultiline = (text: string): string => {\n  if (text.includes(\"\\n\")) {\n    const escaped = text.replace(/\\n/g, \"\\\\n\");\n    // Wrap in {` ... `} so JSX will interpret it as a template literal\n    return `{\\`${escaped}\\`}`;\n  }\n  return text;\n};\n\nexport default function HoverReceiver() {\n  const [hoverBox, setHoverBox] = useState<Box>(null);\n  const [hoverBoxes, setHoverBoxes] = useState<Box[]>([]);\n  const [focusBox, setFocusBox] = useState<Box>(null);\n  const [focusedElementId, setFocusedElementId] = useState<string | null>(null);\n  const [isVisualEditMode, setIsVisualEditMode] = useState(() => {\n    // Initialize from localStorage if available\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(VISUAL_EDIT_MODE_KEY);\n      return stored === \"true\";\n    }\n    return false;\n  });\n  const [isResizing, setIsResizing] = useState(false);\n  const [resizeHandle, setResizeHandle] = useState<string | null>(null);\n  const [resizeStart, setResizeStart] = useState<{\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  } | null>(null);\n  const [isScrolling, setIsScrolling] = useState(false);\n\n  // Tag labels for hover and focus overlays\n  const [hoverTag, setHoverTag] = useState<string | null>(null);\n  const [focusTag, setFocusTag] = useState<string | null>(null);\n  const isResizingRef = useRef(false);\n  const lastHitElementRef = useRef<HTMLElement | null>(null);\n  const lastHitIdRef = useRef<string | null>(null);\n  const focusedElementRef = useRef<HTMLElement | null>(null);\n  const isVisualEditModeRef = useRef(false);\n  const scrollTimeoutRef = useRef<number | null>(null);\n  const originalContentRef = useRef<string>(\"\");\n  const originalSrcRef = useRef<string>(\"\"); // track original img src\n  const focusedImageElementRef = useRef<HTMLImageElement | null>(null); // track the actual img element\n  const editingElementRef = useRef<HTMLElement | null>(null);\n  const wasEditableRef = useRef<boolean>(false);\n  const styleElementRef = useRef<HTMLStyleElement | null>(null);\n  const originalStylesRef = useRef<Record<string, string>>({});\n  const appliedStylesRef = useRef<Map<string, Record<string, string>>>(\n    new Map()\n  );\n  const hasStyleChangesRef = useRef<boolean>(false);\n  const lastClickTimeRef = useRef<number>(0);\n  const pendingCleanupRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Cache of loaded fonts\n  const loadedFontFamilies = useRef<Set<string>>(new Set());\n  // Map of elementId that already has a persistent font set\n  const persistentFontMap = useRef<Map<string, string>>(new Map());\n  // Timeout refs for clearing persistent font map\n  const persistentFontTimeouts = useRef<Map<string, number>>(new Map());\n\n  // Keep ref in sync with state and persist to localStorage\n  useEffect(() => {\n    isVisualEditModeRef.current = isVisualEditMode;\n    // Persist to localStorage\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(VISUAL_EDIT_MODE_KEY, String(isVisualEditMode));\n    }\n  }, [isVisualEditMode]);\n\n  // On mount, notify parent if visual edit mode was restored from localStorage\n  useEffect(() => {\n    if (isVisualEditMode) {\n      // Send acknowledgement to parent that visual edit mode is active\n      // This will sync the parent's state with our restored state\n      window.parent.postMessage(\n        { type: CHANNEL, msg: \"VISUAL_EDIT_MODE_ACK\", active: true },\n        \"*\"\n      );\n\n      // Also send a special message to indicate this was restored from localStorage\n      window.parent.postMessage(\n        { type: CHANNEL, msg: \"VISUAL_EDIT_MODE_RESTORED\", active: true },\n        \"*\"\n      );\n\n      // Restore focused element after a short delay to ensure DOM is ready\n      setTimeout(() => {\n        if (typeof window !== \"undefined\") {\n          // Restore focused element\n          const focusedData = localStorage.getItem(FOCUSED_ELEMENT_KEY);\n          if (focusedData) {\n            try {\n              const { id } = JSON.parse(focusedData);\n              const element = document.querySelector(\n                `[data-orchids-id=\"${id}\"]`\n              ) as HTMLElement;\n\n              if (element) {\n                // Simulate a click on the element to restore focus\n                const rect = element.getBoundingClientRect();\n                const clickEvent = new MouseEvent(\"click\", {\n                  clientX: rect.left + rect.width / 2,\n                  clientY: rect.top + rect.height / 2,\n                  bubbles: true,\n                  cancelable: true,\n                });\n                element.dispatchEvent(clickEvent);\n              }\n            } catch {\n              // Ignore parsing errors\n            }\n          }\n        }\n      }, 500); // Wait 500ms for DOM to be fully ready\n    }\n  }, []); // Run only on mount\n\n  // Helper function to expand box dimensions\n  const expandBox = (rect: DOMRect): Box => ({\n    top: rect.top - BOX_PADDING,\n    left: rect.left - BOX_PADDING,\n    width: rect.width + BOX_PADDING * 2,\n    height: rect.height + BOX_PADDING * 2,\n  });\n\n  // Helper to update focus box position\n  const updateFocusBox = () => {\n    if (focusedElementRef.current) {\n      const r = focusedElementRef.current.getBoundingClientRect();\n      setFocusBox(expandBox(r));\n    }\n  };\n\n  // Add global styles for contentEditable elements\n  useEffect(() => {\n    if (isVisualEditMode && !styleElementRef.current) {\n      const style = document.createElement(\"style\");\n      style.textContent = `\n        [contenteditable=\"true\"]:focus {\n          outline: none !important;\n          box-shadow: none !important;\n          border-color: inherit !important;\n        }\n        [contenteditable=\"true\"] {\n          cursor: text !important;\n        }\n        /* Prevent the default blue highlight on contenteditable */\n        [contenteditable=\"true\"]::selection {\n          background-color: rgba(59, 130, 246, 0.3);\n        }\n        [contenteditable=\"true\"]::-moz-selection {\n          background-color: rgba(59, 130, 246, 0.3);\n        }\n        /* Prevent child elements from being editable */\n        [contenteditable=\"true\"] [contenteditable=\"false\"] {\n          user-select: none !important;\n          -webkit-user-select: none !important;\n          -moz-user-select: none !important;\n          -ms-user-select: none !important;\n          opacity: 0.7 !important;\n          cursor: default !important;\n        }\n        /* Ensure protected elements can't be selected */\n        [data-orchids-protected=\"true\"] {\n          user-select: none !important;\n          -webkit-user-select: none !important;\n          -moz-user-select: none !important;\n          -ms-user-select: none !important;\n        }\n        /* Visual edit overlay styles */\n        .orchids-hover-box {\n          position: fixed;\n          pointer-events: none;\n          border: 0.5px dashed #38bdf8;\n          background-color: rgba(191, 219, 254, 0.2);\n          border-radius: 0.125rem;\n        }\n        .orchids-hover-tag {\n          position: fixed;\n          pointer-events: none;\n          font-size: 10px;\n          color: white;\n          background-color: #38bdf8;\n          padding: 0.125rem 0.25rem;\n          border-radius: 0.125rem;\n        }\n        .orchids-focus-tag {\n          position: fixed;\n          font-size: 10px;\n          font-weight: 600;\n          color: white;\n          background-color: #3b82f6;\n          padding: 0 0.25rem;\n          border-radius: 0.125rem;\n          pointer-events: none;\n          user-select: none;\n        }\n        .orchids-focus-box {\n          position: fixed;\n          pointer-events: none;\n          border: 1.5px solid #38bdf8;\n          border-radius: 0.125rem;\n        }\n        .orchids-resize-handle {\n          position: fixed;\n          width: 0.5rem;\n          height: 0.5rem;\n          background-color: #38bdf8;\n          border-radius: 50%;\n          pointer-events: auto;\n        }\n        .orchids-resize-handle-nw {\n          cursor: nw-resize;\n        }\n        .orchids-resize-handle-ne {\n          cursor: ne-resize;\n        }\n        .orchids-resize-handle-sw {\n          cursor: sw-resize;\n        }\n        .orchids-resize-handle-se {\n          cursor: se-resize;\n        }\n        .orchids-resize-handle-n {\n          cursor: n-resize;\n        }\n        .orchids-resize-handle-s {\n          cursor: s-resize;\n        }\n        .orchids-resize-handle-w {\n          cursor: w-resize;\n        }\n        .orchids-resize-handle-e {\n          cursor: e-resize;\n        }\n      `;\n      document.head.appendChild(style);\n      styleElementRef.current = style;\n    } else if (!isVisualEditMode && styleElementRef.current) {\n      styleElementRef.current.remove();\n      styleElementRef.current = null;\n    }\n\n    return () => {\n      if (styleElementRef.current) {\n        styleElementRef.current.remove();\n        styleElementRef.current = null;\n      }\n    };\n  }, [isVisualEditMode]);\n\n  // Helper to make only text nodes editable and protect child elements\n  const protectChildElements = (element: HTMLElement) => {\n    // Make all child elements non-editable\n    const childElements = element.querySelectorAll(\"*\");\n    childElements.forEach((child) => {\n      const childEl = child as HTMLElement;\n      childEl.contentEditable = \"false\";\n      // Add a data attribute to mark protected elements\n      childEl.setAttribute(\"data-orchids-protected\", \"true\");\n      // Only prevent text selection within the child elements when parent is being edited\n      // But still allow pointer events for hovering and clicking\n      childEl.style.userSelect = \"none\";\n      childEl.style.webkitUserSelect = \"none\";\n      // Don't set pointerEvents to none - we want to allow hover and click\n    });\n  };\n\n  // Helper to restore child elements after editing\n  const restoreChildElements = (element: HTMLElement) => {\n    const protectedElements = element.querySelectorAll(\n      '[data-orchids-protected=\"true\"]'\n    );\n    protectedElements.forEach((child) => {\n      const childEl = child as HTMLElement;\n      childEl.removeAttribute(\"contenteditable\");\n      childEl.removeAttribute(\"data-orchids-protected\");\n      // Restore original styles\n      childEl.style.userSelect = \"\";\n      childEl.style.webkitUserSelect = \"\";\n    });\n  };\n\n  // Handle text changes and send to parent\n  const handleTextChange = (element: HTMLElement) => {\n    // Double-check this is still the editing element to avoid stale closures\n    if (element !== editingElementRef.current) {\n      console.warn(\"Attempting to handle text change for non-editing element\");\n      return;\n    }\n\n    // Get the orchids ID from the element to ensure we're working with the right one\n    const orchidsId = element.getAttribute(\"data-orchids-id\");\n    if (!orchidsId) return;\n\n    // For elements with children, only extract direct text content\n    let newText: string;\n    let oldText: string;\n\n    if (element.childElementCount > 0) {\n      // Element has children - only track direct text nodes\n      newText = extractDirectTextContent(element);\n      // We need to compare against the original direct text content\n      // Since originalContentRef stores the full text, we need to handle this differently\n      oldText = originalContentRef.current;\n    } else {\n      // No children - use innerText to preserve line breaks\n      newText = element.innerText || element.textContent || \"\";\n      oldText = originalContentRef.current;\n    }\n\n    if (newText !== oldText) {\n      const parsed = parseOrchidsId(orchidsId);\n      if (!parsed) return;\n\n      // Send text change message to parent\n      const msg: ChildToParent = {\n        type: CHANNEL,\n        msg: \"TEXT_CHANGED\",\n        id: orchidsId,\n        oldText: wrapMultiline(oldText),\n        newText: wrapMultiline(newText),\n        filePath: parsed.filePath,\n        line: parsed.line,\n        column: parsed.column,\n      };\n\n      postMessageDedup(msg);\n\n      // Update the original content reference\n      originalContentRef.current = newText;\n    }\n  };\n\n  // Handle style changes and send to parent\n  const handleStyleChange = (\n    element: HTMLElement,\n    styles: Record<string, string>\n  ) => {\n    const orchidsId = element.getAttribute(\"data-orchids-id\");\n    if (!orchidsId) return;\n\n    const parsed = parseOrchidsId(orchidsId);\n    if (!parsed) return;\n\n    // Find ALL elements with the same orchids ID\n    const allMatchingElements = document.querySelectorAll(\n      `[data-orchids-id=\"${orchidsId}\"]`\n    ) as NodeListOf<HTMLElement>;\n\n    // Apply styles to ALL matching elements for visual feedback\n    allMatchingElements.forEach((el) => {\n      Object.entries(styles).forEach(([property, value]) => {\n        // Convert camelCase to kebab-case for CSS property names\n        const cssProp = property.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n\n        // Handle special cases for default values\n        let finalValue = value;\n\n        // If backgroundColor is being set to transparent, use transparent keyword\n        if (\n          property === \"backgroundColor\" &&\n          (value === \"transparent\" ||\n            value === \"rgba(0, 0, 0, 0)\" ||\n            value === \"rgb(0, 0, 0, 0)\")\n        ) {\n          finalValue = \"transparent\";\n        }\n\n        // If removing styles (setting to default), remove the property\n        if (\n          (property === \"backgroundColor\" && finalValue === \"transparent\") ||\n          (property === \"backgroundImage\" && value === \"none\") ||\n          (property === \"textDecoration\" && value === \"none\") ||\n          (property === \"fontStyle\" && value === \"normal\") ||\n          (property === \"opacity\" && value === \"1\") ||\n          ((property.includes(\"padding\") || property.includes(\"margin\")) &&\n            value === \"0\") ||\n          (property === \"borderRadius\" && value === \"0\") ||\n          (property === \"letterSpacing\" && value === \"normal\") ||\n          (property === \"gap\" && value === \"normal\")\n        ) {\n          // Remove the property to let the stylesheet value show through\n          el.style.removeProperty(cssProp);\n        } else {\n          // Apply with !important so it overrides existing rules\n          el.style.setProperty(cssProp, finalValue, \"important\");\n        }\n      });\n    });\n\n    // Store the applied styles\n    const existingStyles = appliedStylesRef.current.get(orchidsId) || {};\n    appliedStylesRef.current.set(orchidsId, { ...existingStyles, ...styles });\n    hasStyleChangesRef.current = true;\n\n    // Update the focus box after style change\n    requestAnimationFrame(() => {\n      updateFocusBox();\n    });\n\n    // Don't send to parent yet - wait for blur\n  };\n\n  // Send style changes on blur\n  const handleStyleBlur = (element: HTMLElement) => {\n    if (!hasStyleChangesRef.current) return;\n\n    const orchidsId = element.getAttribute(\"data-orchids-id\");\n    if (!orchidsId) return;\n\n    const parsed = parseOrchidsId(orchidsId);\n    if (!parsed) return;\n\n    const appliedStyles = appliedStylesRef.current.get(orchidsId);\n    if (!appliedStyles || Object.keys(appliedStyles).length === 0) return;\n\n    // Get className for breakpoint detection\n    const className = element.getAttribute(\"class\") || \"\";\n\n    // Send style blur message to parent for Tailwind conversion\n    const msg: ChildToParent = {\n      type: CHANNEL,\n      msg: \"STYLE_BLUR\",\n      id: orchidsId,\n      styles: appliedStyles,\n      className,\n      filePath: parsed.filePath,\n      line: parsed.line,\n      column: parsed.column,\n    };\n\n    postMessageDedup(msg);\n\n    // Reset style changes flag\n    hasStyleChangesRef.current = false;\n  };\n\n  // Flush image src updates on blur/focus change\n  const flushImageSrcChange = () => {\n    // Use the stored image element reference if available\n    const imgElement = focusedImageElementRef.current;\n    if (!imgElement) return;\n\n    const orchidsId = imgElement.getAttribute(\"data-orchids-id\");\n    if (!orchidsId) return;\n\n    const parsed = parseOrchidsId(orchidsId);\n    if (!parsed) return;\n\n    const newSrc = normalizeImageSrc(imgElement.src);\n    const oldSrc = normalizeImageSrc(originalSrcRef.current);\n\n    if (!newSrc || newSrc === oldSrc) return; // nothing changed\n\n    const msg: ChildToParent = {\n      type: CHANNEL,\n      msg: \"IMAGE_BLUR\",\n      id: orchidsId,\n      oldSrc,\n      newSrc,\n      filePath: parsed.filePath,\n      line: parsed.line,\n      column: parsed.column,\n    };\n\n    postMessageDedup(msg);\n\n    originalSrcRef.current = newSrc; // reset baseline\n    focusedImageElementRef.current = null; // clear reference\n  };\n\n  // Listen for style and image updates from parent\n  useEffect(() => {\n    function handleMessage(e: MessageEvent) {\n      if (e.data?.type === \"ORCHIDS_STYLE_UPDATE\") {\n        const { elementId, styles } = e.data;\n\n        // Find ALL elements with the same orchids ID\n        const allMatchingElements = document.querySelectorAll(\n          `[data-orchids-id=\"${elementId}\"]`\n        ) as NodeListOf<HTMLElement>;\n\n        if (allMatchingElements.length > 0) {\n          // If fontFamily is present ensure stylesheet loaded first\n          const fam = styles.fontFamily || styles[\"fontFamily\"];\n          if (fam) {\n            const familyKey = fam.replace(/['\\s]+/g, \"+\");\n            if (!loadedFontFamilies.current.has(familyKey)) {\n              const link = document.createElement(\"link\");\n              link.rel = \"stylesheet\";\n              link.href = `https://fonts.googleapis.com/css2?family=${familyKey}:wght@400&display=swap`;\n              document.head.appendChild(link);\n              loadedFontFamilies.current.add(familyKey);\n            }\n          }\n\n          // If fontFamily made persistent via style update, remember so previews don't override\n          if (fam) {\n            persistentFontMap.current.set(elementId, fam);\n\n            // Clear any existing timeout\n            const existingTimeout =\n              persistentFontTimeouts.current.get(elementId);\n            if (existingTimeout) {\n              clearTimeout(existingTimeout);\n            }\n\n            // Set timeout to clear persistent font after 2 seconds, allowing previews again\n            const timeoutId = window.setTimeout(() => {\n              persistentFontMap.current.delete(elementId);\n              persistentFontTimeouts.current.delete(elementId);\n            }, 2000);\n\n            persistentFontTimeouts.current.set(elementId, timeoutId);\n          }\n\n          // Apply styles to ALL matching elements\n          allMatchingElements.forEach((element) => {\n            // Only update handleStyleChange for the focused element to track changes\n            if (focusedElementRef.current === element) {\n              handleStyleChange(element, styles);\n            } else {\n              // For other elements, apply styles directly\n              Object.entries(styles).forEach(([property, value]) => {\n                const cssProp = property\n                  .replace(/([A-Z])/g, \"-$1\")\n                  .toLowerCase();\n\n                // Handle special cases for default values\n                let finalValue = String(value);\n\n                // If backgroundColor is being set to transparent, use transparent keyword\n                if (\n                  property === \"backgroundColor\" &&\n                  (value === \"transparent\" ||\n                    value === \"rgba(0, 0, 0, 0)\" ||\n                    value === \"rgb(0, 0, 0, 0)\")\n                ) {\n                  finalValue = \"transparent\";\n                }\n\n                // If removing styles (setting to default), remove the property\n                if (\n                  (property === \"backgroundColor\" &&\n                    finalValue === \"transparent\") ||\n                  (property === \"backgroundImage\" && value === \"none\") ||\n                  (property === \"textDecoration\" && value === \"none\") ||\n                  (property === \"fontStyle\" && value === \"normal\") ||\n                  (property === \"opacity\" && value === \"1\") ||\n                  ((property.includes(\"padding\") ||\n                    property.includes(\"margin\")) &&\n                    value === \"0\") ||\n                  (property === \"borderRadius\" && value === \"0\") ||\n                  (property === \"letterSpacing\" && value === \"normal\") ||\n                  (property === \"gap\" && value === \"normal\")\n                ) {\n                  // Remove the property to let the stylesheet value show through\n                  element.style.removeProperty(cssProp);\n                } else {\n                  element.style.setProperty(cssProp, finalValue, \"important\");\n                }\n              });\n            }\n          });\n        }\n      } else if (e.data?.type === \"ORCHIDS_IMAGE_UPDATE\") {\n        const { elementId, src, oldSrc } = e.data;\n        let element: HTMLImageElement | null = null;\n        const candidates = document.querySelectorAll(\n          `[data-orchids-id=\"${elementId}\"]`\n        );\n        candidates.forEach((el) => {\n          if (el.tagName.toLowerCase() === \"img\") {\n            const img = el as HTMLImageElement;\n            const norm = normalizeImageSrc(img.src);\n            if (!element) element = img; // first fallback\n            if (oldSrc && normalizeImageSrc(oldSrc) === norm) {\n              element = img;\n            }\n          }\n        });\n\n        if (!element) return;\n\n        if ((element as HTMLElement).tagName.toLowerCase() === \"img\") {\n          const imgEl = element as HTMLImageElement;\n\n          {\n            /*\n             * Clear any existing responsive sources so the newly uploaded image\n             * always displays.  Some frameworks (e.g. Next.js) add a `srcset`\n             * attribute which can override `src` in certain viewport/device\n             * scenarios, so we strip it out before setting the new source.\n             */\n            imgEl.removeAttribute(\"srcset\");\n            imgEl.srcset = \"\";\n\n            imgEl.src = src;\n\n            // Update baseline src so flush doesn't treat this as pending change\n            originalSrcRef.current = normalizeImageSrc(src);\n            focusedImageElementRef.current = imgEl;\n\n            imgEl.onload = () => updateFocusBox();\n          }\n        }\n      } else if (e.data?.type === \"RESIZE_ELEMENT\") {\n        const { elementId, width, height } = e.data;\n        const element = document.querySelector(\n          `[data-orchids-id=\"${elementId}\"]`\n        ) as HTMLElement;\n\n        if (element && focusedElementRef.current === element) {\n          // Apply temporary resize styles\n          element.style.setProperty(\"width\", `${width}px`, \"important\");\n          element.style.setProperty(\"height\", `${height}px`, \"important\");\n\n          // Update focus box\n          updateFocusBox();\n        }\n      }\n    }\n\n    window.addEventListener(\"message\", handleMessage);\n    return () => window.removeEventListener(\"message\", handleMessage);\n  }, []);\n\n  // Handle resize\n  const handleResizeStart = (e: React.MouseEvent, handle: string) => {\n    if (!focusedElementRef.current) return;\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const rect = focusedElementRef.current.getBoundingClientRect();\n\n    // Clear any hover overlay when starting resize\n    setHoverBox(null);\n    lastHitElementRef.current = null;\n\n    // Disable pointer events on body to prevent hover detection\n    document.body.style.pointerEvents = \"none\";\n    // Keep resize handles interactive\n    const resizeHandles = document.querySelectorAll(\".resize-handle\");\n    resizeHandles.forEach((handle) => {\n      (handle as HTMLElement).style.pointerEvents = \"auto\";\n    });\n\n    setIsResizing(true);\n    isResizingRef.current = true;\n    setResizeHandle(handle);\n    setResizeStart({\n      x: e.clientX,\n      y: e.clientY,\n      width: rect.width,\n      height: rect.height,\n    });\n  };\n\n  // Handle resize move\n  useEffect(() => {\n    if (\n      !isResizing ||\n      !resizeStart ||\n      !resizeHandle ||\n      !focusedElementRef.current\n    )\n      return;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      const dx = e.clientX - resizeStart.x;\n      const dy = e.clientY - resizeStart.y;\n\n      let newWidth = resizeStart.width;\n      let newHeight = resizeStart.height;\n\n      // Calculate new dimensions based on handle\n      if (resizeHandle.includes(\"e\")) newWidth = resizeStart.width + dx;\n      if (resizeHandle.includes(\"w\")) newWidth = resizeStart.width - dx;\n      if (resizeHandle.includes(\"s\")) newHeight = resizeStart.height + dy;\n      if (resizeHandle.includes(\"n\")) newHeight = resizeStart.height - dy;\n\n      // Get parent container for constraints\n      const parent = focusedElementRef.current?.parentElement;\n      if (parent) {\n        const parentRect = parent.getBoundingClientRect();\n        const parentStyles = window.getComputedStyle(parent);\n        const parentPaddingLeft = parseFloat(parentStyles.paddingLeft) || 0;\n        const parentPaddingRight = parseFloat(parentStyles.paddingRight) || 0;\n        const parentPaddingTop = parseFloat(parentStyles.paddingTop) || 0;\n        const parentPaddingBottom = parseFloat(parentStyles.paddingBottom) || 0;\n\n        const maxWidth =\n          parentRect.width - parentPaddingLeft - parentPaddingRight;\n        const maxHeight =\n          parentRect.height - parentPaddingTop - parentPaddingBottom;\n\n        /*\n         * Soft-clamp strategy: we respect the parent’s max size until the\n         * user’s cursor actually travels beyond that limit.  As soon as the\n         * drag distance would produce a dimension larger than the container\n         * can accommodate we stop clamping and let the element follow the\n         * cursor, effectively allowing it to “spill” out of its parent.\n         */\n        const exceedsWidth = newWidth > maxWidth;\n        const exceedsHeight = newHeight > maxHeight;\n\n        newWidth = Math.max(\n          20,\n          exceedsWidth ? newWidth : Math.min(newWidth, maxWidth)\n        );\n\n        newHeight = Math.max(\n          20,\n          exceedsHeight ? newHeight : Math.min(newHeight, maxHeight)\n        );\n      } else {\n        // Fallback to minimum dimensions if no parent\n        newWidth = Math.max(20, newWidth);\n        newHeight = Math.max(20, newHeight);\n      }\n\n      // Ensure hover box stays hidden during resize\n      if (hoverBox) {\n        setHoverBox(null);\n      }\n\n      // Send resize message to parent\n      if (focusedElementId) {\n        window.parent.postMessage(\n          {\n            type: CHANNEL,\n            msg: \"RESIZE_ELEMENT\",\n            elementId: focusedElementId,\n            width: Math.round(newWidth),\n            height: Math.round(newHeight),\n          },\n          \"*\"\n        );\n      }\n    };\n\n    const handleMouseUp = () => {\n      if (focusedElementRef.current && focusedElementId) {\n        const element = focusedElementRef.current;\n        const computedStyle = window.getComputedStyle(element);\n        const width = parseFloat(computedStyle.width) || element.offsetWidth;\n        const height = parseFloat(computedStyle.height) || element.offsetHeight;\n\n        // Check if element has max-width/max-height constraints\n        const maxWidth = computedStyle.maxWidth;\n        const maxHeight = computedStyle.maxHeight;\n        const hasMaxWidth =\n          maxWidth && maxWidth !== \"none\" && maxWidth !== \"initial\";\n        const hasMaxHeight =\n          maxHeight && maxHeight !== \"none\" && maxHeight !== \"initial\";\n\n        // Try to use relative units when possible\n        const parent = element.parentElement;\n        let widthValue = `${Math.round(width)}px`;\n        let heightValue = `${Math.round(height)}px`;\n\n        if (parent) {\n          const parentRect = parent.getBoundingClientRect();\n          const parentStyles = window.getComputedStyle(parent);\n          const parentPaddingLeft = parseFloat(parentStyles.paddingLeft) || 0;\n          const parentPaddingRight = parseFloat(parentStyles.paddingRight) || 0;\n          const parentPaddingTop = parseFloat(parentStyles.paddingTop) || 0;\n          const parentPaddingBottom =\n            parseFloat(parentStyles.paddingBottom) || 0;\n\n          const parentInnerWidth =\n            parentRect.width - parentPaddingLeft - parentPaddingRight;\n          const parentInnerHeight =\n            parentRect.height - parentPaddingTop - parentPaddingBottom;\n\n          // If the element takes up a significant portion of parent, use percentage\n          const widthPercent = (width / parentInnerWidth) * 100;\n          const heightPercent = (height / parentInnerHeight) * 100;\n\n          // Use percentage if it's a round number or close to common values\n          if (\n            Math.abs(widthPercent - Math.round(widthPercent)) < 0.1 ||\n            [25, 33.333, 50, 66.667, 75, 100].some(\n              (v) => Math.abs(widthPercent - v) < 0.5\n            )\n          ) {\n            widthValue = `${Math.round(widthPercent * 10) / 10}%`;\n          }\n\n          // For height, be more conservative with percentages (often px is preferred)\n          if (\n            Math.abs(heightPercent - Math.round(heightPercent)) < 0.1 &&\n            [25, 50, 75, 100].includes(Math.round(heightPercent))\n          ) {\n            heightValue = `${Math.round(heightPercent)}%`;\n          }\n        }\n\n        // Build styles object\n        const styles: Record<string, string> = {};\n\n        // Always set a fixed width and height to break out of responsive classes.\n        styles.width = widthValue;\n        styles.height = heightValue;\n\n        // If the element had a max-width constraint (e.g. from `max-w-full`),\n        // we update it to the new width to ensure the resize is not capped.\n        if (hasMaxWidth) {\n          styles.maxWidth = widthValue;\n        }\n\n        // Same for height.\n        if (hasMaxHeight) {\n          styles.maxHeight = heightValue;\n        }\n\n        // Send final dimensions as style change\n        const msg: ChildToParent = {\n          type: CHANNEL,\n          msg: \"STYLE_BLUR\",\n          id: focusedElementId,\n          styles,\n          filePath: \"\",\n          line: 0,\n          column: 0,\n          className: element.getAttribute(\"class\") || \"\",\n        };\n\n        // Extract file info from data-orchids-id\n        const orchidsId = element.getAttribute(\"data-orchids-id\");\n        if (orchidsId) {\n          const parsed = parseOrchidsId(orchidsId);\n          if (parsed) {\n            msg.filePath = parsed.filePath;\n            msg.line = parsed.line;\n            msg.column = parsed.column;\n          }\n        }\n\n        window.parent.postMessage(msg, \"*\");\n      }\n\n      setIsResizing(false);\n      isResizingRef.current = false;\n      setResizeHandle(null);\n      setResizeStart(null);\n\n      // Re-enable pointer events\n      document.body.style.pointerEvents = \"\";\n\n      // Clear the last hit element to force re-detection after resize\n      lastHitElementRef.current = null;\n    };\n\n    document.addEventListener(\"mousemove\", handleMouseMove);\n    document.addEventListener(\"mouseup\", handleMouseUp);\n\n    return () => {\n      document.removeEventListener(\"mousemove\", handleMouseMove);\n      document.removeEventListener(\"mouseup\", handleMouseUp);\n    };\n  }, [isResizing, resizeStart, resizeHandle, focusedElementId, hoverBox]); // Added focusedElementId and hoverBox as dependencies\n\n  // Cleanup function to restore element state\n  const cleanupEditingElement = () => {\n    if (editingElementRef.current) {\n      const element = editingElementRef.current;\n\n      // Immediately clear the ref to prevent any further operations\n      editingElementRef.current = null;\n\n      // Flush pending style edits first for the same reason described above\n      handleStyleBlur(element);\n\n      // Now process text changes\n      handleTextChange(element);\n\n      // Restore child elements if they were protected\n      if (element.childElementCount > 0) {\n        restoreChildElements(element);\n      }\n\n      // Only set contentEditable to false if we made it true\n      if (!wasEditableRef.current) {\n        element.contentEditable = \"false\";\n      }\n\n      // Don't restore original styles - keep the applied styles\n      // Remove the outline suppression styles only\n      const currentStyle = element.getAttribute(\"style\") || \"\";\n      const cleanedStyle = currentStyle\n        .replace(/outline:\\s*none\\s*!important;?/gi, \"\")\n        .replace(/box-shadow:\\s*none\\s*!important;?/gi, \"\")\n        .trim()\n        .replace(/;\\s*;/g, \";\")\n        .replace(/^;|;$/g, \"\");\n\n      if (cleanedStyle) {\n        element.setAttribute(\"style\", cleanedStyle);\n      } else {\n        element.removeAttribute(\"style\");\n      }\n\n      element.blur();\n\n      // Remove event handlers\n      const handlers = (element as any)._editHandlers;\n      if (handlers) {\n        element.removeEventListener(\"focus\", handlers.focus);\n        element.removeEventListener(\"blur\", handlers.blur);\n        element.removeEventListener(\"input\", handlers.input);\n        delete (element as any)._editHandlers;\n      }\n\n      wasEditableRef.current = false;\n      // Clear the original content reference\n      originalContentRef.current = \"\";\n    }\n  };\n\n  // Prevent all navigation in visual edit mode\n  useEffect(() => {\n    if (!isVisualEditMode) return;\n\n    // Prevent link clicks\n    const preventLinkClick = (e: Event) => {\n      const target = e.target as HTMLElement;\n      const link = target.closest(\"a\");\n      if (link && !link.isContentEditable) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    };\n\n    // Prevent form submissions\n    const preventFormSubmit = (e: Event) => {\n      e.preventDefault();\n      e.stopPropagation();\n    };\n\n    // Add listeners in capture phase to catch events early\n    document.addEventListener(\"click\", preventLinkClick, true);\n    document.addEventListener(\"submit\", preventFormSubmit, true);\n\n    return () => {\n      document.removeEventListener(\"click\", preventLinkClick, true);\n      document.removeEventListener(\"submit\", preventFormSubmit, true);\n    };\n  }, [isVisualEditMode]);\n\n  // Clean up when exiting visual edit mode\n  useEffect(() => {\n    if (!isVisualEditMode) {\n      cleanupEditingElement();\n      // Clear applied styles tracking\n      appliedStylesRef.current.clear();\n      hasStyleChangesRef.current = false;\n\n      // Clear image element reference\n      focusedImageElementRef.current = null;\n    }\n  }, [isVisualEditMode]);\n\n  // Update focus box position when scrolling or resizing\n  useEffect(() => {\n    if (focusedElementRef.current) {\n      const handleUpdate = () => {\n        updateFocusBox();\n\n        if (focusedElementRef.current && focusedElementId) {\n          const fr = focusedElementRef.current.getBoundingClientRect();\n          const fBox = expandBox(fr);\n          if (fBox) {\n            const focMsg: ChildToParent = {\n              type: CHANNEL,\n              msg: \"FOCUS_MOVED\",\n              id: focusedElementId,\n              rect: {\n                top: fBox.top,\n                left: fBox.left,\n                width: fBox.width,\n                height: fBox.height,\n              },\n            };\n            postMessageDedup(focMsg);\n          }\n        }\n      };\n\n      window.addEventListener(\"scroll\", handleUpdate, true);\n      window.addEventListener(\"resize\", handleUpdate);\n\n      // Also observe the focused element for size changes\n      const resizeObserver = new ResizeObserver(handleUpdate);\n      resizeObserver.observe(focusedElementRef.current);\n\n      return () => {\n        window.removeEventListener(\"scroll\", handleUpdate, true);\n        window.removeEventListener(\"resize\", handleUpdate);\n        resizeObserver.disconnect();\n      };\n    }\n  }, [focusedElementId]);\n\n  useEffect(() => {\n    // Handle pointer movement directly in the iframe\n    function onPointerMove(e: PointerEvent) {\n      if (isResizingRef.current) {\n        return;\n      }\n      // Only track pointer when visual edit mode is active\n      if (!isVisualEditModeRef.current) return;\n\n      // Don't show hover boxes while scrolling\n      if (isScrolling) return;\n\n      // Hit-testing at pointer position\n      const hit =\n        document\n          .elementFromPoint(e.clientX, e.clientY)\n          ?.closest<HTMLElement>(\"[data-orchids-id]\") ?? null;\n\n      if (hit !== lastHitElementRef.current) {\n        lastHitElementRef.current = hit;\n\n        if (!hit) {\n          setHoverBox(null);\n          setHoverBoxes([]);\n          setHoverTag(null);\n          lastHitIdRef.current = null;\n          // If we were previously focused on an image, ensure its src is flushed\n          flushImageSrcChange();\n\n          const msg: ChildToParent = {\n            type: CHANNEL,\n            msg: \"HIT\",\n            id: null,\n            tag: null,\n            rect: null,\n          };\n          postMessageDedup(msg);\n          return;\n        }\n\n        // Don't show hover box if this is the focused element\n        const hitId = hit.getAttribute(\"data-orchids-id\");\n\n        // Check if we're already showing boxes for this ID\n        if (hitId === lastHitIdRef.current) {\n          return;\n        }\n\n        lastHitIdRef.current = hitId;\n\n        const tagName =\n          hit.getAttribute(\"data-orchids-name\") || hit.tagName.toLowerCase();\n\n        // Update hover boxes immediately for instant feedback\n        // Find ALL elements with the same orchids ID\n        const allMatchingElements = document.querySelectorAll(\n          `[data-orchids-id=\"${hitId}\"]`\n        ) as NodeListOf<HTMLElement>;\n\n        // Create hover boxes for all matching elements except the focused one\n        const boxes: Box[] = [];\n        allMatchingElements.forEach((element) => {\n          // Skip if this element is the focused one\n          const elementId = element.getAttribute(\"data-orchids-id\");\n          if (elementId === focusedElementId) {\n            return;\n          }\n\n          const rect = element.getBoundingClientRect();\n          boxes.push(expandBox(rect));\n        });\n\n        // Set multiple hover boxes\n        setHoverBoxes(boxes);\n\n        // Set single hover box for the primary element (for compatibility)\n        // Only set if it's not the focused element\n        if (hitId !== focusedElementId) {\n          const r = hit.getBoundingClientRect();\n          const expandedBox = expandBox(r);\n          setHoverBox(expandedBox);\n        } else {\n          setHoverBox(null);\n        }\n\n        setHoverTag(tagName);\n\n        const msg: ChildToParent = {\n          type: CHANNEL,\n          msg: \"HIT\",\n          id: hitId,\n          tag: tagName,\n          rect:\n            hitId !== focusedElementId\n              ? expandBox(hit.getBoundingClientRect())\n              : null,\n        };\n        postMessageDedup(msg);\n      }\n    }\n\n    // Handle pointer leaving the document\n    function onPointerLeave() {\n      if (!isVisualEditModeRef.current) return;\n\n      if (isResizingRef.current) return;\n\n      setHoverBox(null);\n      setHoverBoxes([]);\n      setHoverTag(null);\n\n      // Flush image src change when cursor leaves iframe altogether\n      flushImageSrcChange();\n\n      lastHitElementRef.current = null;\n      lastHitIdRef.current = null;\n      const msg: ChildToParent = {\n        type: CHANNEL,\n        msg: \"HIT\",\n        id: null,\n        tag: null,\n        rect: null,\n      };\n      postMessageDedup(msg);\n    }\n\n    // Handle mousedown to prepare element for editing\n    function onMouseDownCapture(e: MouseEvent) {\n      if (isResizingRef.current) return;\n      // Only handle if visual edit mode is active\n      if (!isVisualEditModeRef.current) return;\n\n      const hit = (e.target as HTMLElement)?.closest<HTMLElement>(\n        \"[data-orchids-id]\"\n      );\n\n      if (hit && isTextEditable(hit)) {\n        // Store whether it was already editable\n        wasEditableRef.current = hit.contentEditable === \"true\";\n\n        // Make element editable BEFORE the click goes through\n        if (!wasEditableRef.current) {\n          // Apply inline styles to remove focus ring\n          const currentStyle = hit.getAttribute(\"style\") || \"\";\n          hit.setAttribute(\n            \"style\",\n            `${currentStyle}; outline: none !important; box-shadow: none !important;`\n          );\n\n          hit.contentEditable = \"true\";\n\n          // If the element has children, protect them from being edited\n          if (hit.childElementCount > 0) {\n            protectChildElements(hit);\n          }\n        }\n      }\n    }\n\n    // Handle clicks to focus elements\n    function onClickCapture(e: MouseEvent) {\n      if (isResizingRef.current) return;\n      // Only handle if visual edit mode is active\n      if (!isVisualEditModeRef.current) return;\n\n      // Debounce rapid clicks\n      const now = Date.now();\n      if (now - lastClickTimeRef.current < 100) {\n        return; // Ignore clicks within 100ms of each other\n      }\n      lastClickTimeRef.current = now;\n\n      const target = e.target as HTMLElement;\n      const hit = target.closest<HTMLElement>(\"[data-orchids-id]\");\n\n      if (hit) {\n        const tagName =\n          hit.getAttribute(\"data-orchids-name\") || hit.tagName.toLowerCase();\n\n        const hitId = hit.getAttribute(\"data-orchids-id\");\n        const isEditable = isTextEditable(hit);\n\n        // Always prevent default for non-text interactions\n        const isLink = hit.tagName.toLowerCase() === \"a\" || !!hit.closest(\"a\");\n        const isButton =\n          hit.tagName.toLowerCase() === \"button\" ||\n          hit.getAttribute(\"role\") === \"button\";\n\n        // Prevent navigation and button actions\n        if (isLink || isButton || !isEditable) {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n\n        // Capture previously focused element before updating\n        const prevFocused = focusedElementRef.current;\n\n        // Update focused element\n        focusedElementRef.current = hit;\n        setFocusedElementId(hitId);\n        setFocusTag(tagName);\n\n        // Save focused element info to localStorage\n        if (hitId && typeof window !== \"undefined\") {\n          const focusedElementData = {\n            id: hitId,\n            tag: tagName,\n          };\n          localStorage.setItem(\n            FOCUSED_ELEMENT_KEY,\n            JSON.stringify(focusedElementData)\n          );\n        }\n\n        // Find ALL other elements with the same orchids ID and show hover boxes\n        const allMatchingElements = document.querySelectorAll(\n          `[data-orchids-id=\"${hitId}\"]`\n        ) as NodeListOf<HTMLElement>;\n\n        // Create hover boxes for all matching elements except the focused one\n        const boxes: Box[] = [];\n        allMatchingElements.forEach((element) => {\n          // Skip the focused element itself\n          if (element === hit) {\n            return;\n          }\n\n          const rect = element.getBoundingClientRect();\n          boxes.push(expandBox(rect));\n        });\n\n        // Set hover boxes for other matching elements\n        setHoverBoxes(boxes);\n        // Set the hover tag to show on other elements\n        if (boxes.length > 0) {\n          setHoverTag(tagName);\n        }\n\n        // Track image element specifically\n        if (hit.tagName.toLowerCase() === \"img\") {\n          focusedImageElementRef.current = hit as HTMLImageElement;\n        } else {\n          focusedImageElementRef.current = null;\n        }\n\n        // Store original styles for the focused element\n        originalStylesRef.current = getCurrentStyles(hit);\n\n        // If this is an editable element, set it up\n        if (isEditable) {\n          // Cancel any pending cleanup\n          if (pendingCleanupRef.current) {\n            clearTimeout(pendingCleanupRef.current);\n            pendingCleanupRef.current = null;\n          }\n\n          // Clean up any previous editing element first\n          if (editingElementRef.current && editingElementRef.current !== hit) {\n            // Force blur on the previous element to trigger handlers\n            editingElementRef.current.blur();\n            cleanupEditingElement();\n          }\n\n          // Only set up if this is a new element\n          if (hit !== editingElementRef.current) {\n            editingElementRef.current = hit;\n            // Store original content - for elements with children, only store direct text\n            if (hit.childElementCount > 0) {\n              originalContentRef.current = extractDirectTextContent(hit);\n            } else {\n              originalContentRef.current =\n                hit.innerText || hit.textContent || \"\";\n            }\n\n            // Create handlers with current element reference\n            const createHandlers = (element: HTMLElement) => {\n              const handleFocus = () => {\n                // Double-check this is still the editing element\n                if (element !== editingElementRef.current) return;\n\n                // If the user applied inline style edits **before** entering text\n                // editing mode, make sure we commit them right away so that the\n                // subsequent text edits operate on the updated source.\n                handleStyleBlur(element);\n\n                // Update original content - for elements with children, only store direct text\n                if (element.childElementCount > 0) {\n                  originalContentRef.current =\n                    extractDirectTextContent(element);\n                } else {\n                  originalContentRef.current =\n                    element.innerText || element.textContent || \"\";\n                }\n\n                // Style blur above resets the flag – keep it in sync.\n                hasStyleChangesRef.current = false;\n              };\n\n              const handleBlur = () => {\n                // Double-check this is still the editing element\n                if (element !== editingElementRef.current) return;\n\n                // Flush style changes *before* text changes so that the style\n                // update is committed with the original line/column offsets.\n                // A subsequent text update may shift the source code which would\n                // otherwise cause the later style edit to fail.\n                handleStyleBlur(element);\n                handleTextChange(element);\n              };\n\n              const handleInput = () => {\n                // Double-check this is still the editing element\n                if (element !== editingElementRef.current) return;\n                // Optionally handle real-time updates\n                // handleTextChange(element);\n              };\n\n              return { handleFocus, handleBlur, handleInput };\n            };\n\n            const handlers = createHandlers(hit);\n            hit.addEventListener(\"focus\", handlers.handleFocus);\n            hit.addEventListener(\"blur\", handlers.handleBlur);\n            hit.addEventListener(\"input\", handlers.handleInput);\n\n            // Store handlers for cleanup\n            (hit as any)._editHandlers = {\n              focus: handlers.handleFocus,\n              blur: handlers.handleBlur,\n              input: handlers.handleInput,\n            };\n          }\n        }\n\n        // Update focus box with expanded dimensions\n        const r = hit.getBoundingClientRect();\n        const expandedBox = expandBox(r);\n        setFocusBox(expandedBox);\n\n        // Clear hover box since we're focusing\n        setHoverBox(null);\n\n        // Get className for Tailwind extraction\n        const className = hit.getAttribute(\"class\") || \"\";\n\n        // Get src for images & track original\n        const srcRaw =\n          hit.tagName.toLowerCase() === \"img\"\n            ? (hit as HTMLImageElement).src\n            : undefined;\n\n        if (srcRaw) {\n          originalSrcRef.current = normalizeImageSrc(srcRaw);\n        }\n\n        // Get current styles immediately\n        const computedStyles = getCurrentStyles(hit);\n\n        // Send click event to parent with coordinates and current styles\n        const msg: ChildToParent = {\n          type: CHANNEL,\n          msg: \"ELEMENT_CLICKED\",\n          id: hitId,\n          tag: tagName,\n          rect: expandedBox\n            ? {\n                top: expandedBox.top,\n                left: expandedBox.left,\n                width: expandedBox.width,\n                height: expandedBox.height,\n              }\n            : {\n                top: 0,\n                left: 0,\n                width: 0,\n                height: 0,\n              },\n          clickPosition: {\n            x: e.clientX,\n            y: e.clientY,\n          },\n          isEditable,\n          currentStyles: computedStyles,\n          className,\n          src: srcRaw,\n        };\n\n        // Send message with all data at once\n        postMessageDedup(msg);\n\n        // Move cleanup operations to after message is sent\n        setTimeout(() => {\n          // Before changing focus, flush pending image src change\n          flushImageSrcChange();\n\n          // Flush style changes for the previously focused element (if any)\n          if (prevFocused && prevFocused !== hit) {\n            handleStyleBlur(prevFocused);\n          }\n\n          // Clean up any previous editing element (if it's different)\n          if (editingElementRef.current && editingElementRef.current !== hit) {\n            cleanupEditingElement();\n          }\n        }, 0);\n      } else {\n        // Clicked on empty space or element without data-orchids-id\n        // Clear focus and hover boxes\n        if (focusedElementRef.current) {\n          // Flush any pending changes\n          flushImageSrcChange();\n          handleStyleBlur(focusedElementRef.current);\n          cleanupEditingElement();\n\n          // Clear all focus and hover states\n          focusedElementRef.current = null;\n          setFocusedElementId(null);\n          setFocusTag(null);\n          setFocusBox(null);\n          setHoverBox(null);\n          setHoverBoxes([]);\n          setHoverTag(null);\n\n          // Clear focused element from localStorage\n          if (typeof window !== \"undefined\") {\n            localStorage.removeItem(FOCUSED_ELEMENT_KEY);\n          }\n\n          // Notify parent that focus was cleared\n          const msg: ChildToParent = {\n            type: CHANNEL,\n            msg: \"ELEMENT_CLICKED\",\n            id: null,\n            tag: null,\n            rect: {\n              top: 0,\n              left: 0,\n              width: 0,\n              height: 0,\n            },\n            clickPosition: {\n              x: e.clientX,\n              y: e.clientY,\n            },\n            isEditable: false,\n            currentStyles: {},\n            className: \"\",\n          };\n          postMessageDedup(msg);\n        }\n      }\n    }\n\n    // Handle messages from parent\n    function onMsg(e: MessageEvent<ParentToChild>) {\n      if (e.data?.type !== CHANNEL) return;\n\n      // Handle preview font request from parent\n      if (e.data.msg === \"PREVIEW_FONT\" && \"elementId\" in e.data) {\n        const { elementId, fontFamily } = e.data;\n\n        // Skip if font already persisted for this element to avoid race condition\n        if (persistentFontMap.current.has(elementId)) {\n          return;\n        }\n\n        const element = document.querySelector(\n          `[data-orchids-id=\"${elementId}\"]`\n        ) as HTMLElement | null;\n        if (!element) return;\n\n        // Ensure font stylesheet is loaded\n        const familyKey = fontFamily.replace(/\\s+/g, \"+\");\n        if (!loadedFontFamilies.current.has(familyKey)) {\n          const link = document.createElement(\"link\");\n          link.rel = \"stylesheet\";\n          link.href = `https://fonts.googleapis.com/css2?family=${familyKey}:wght@400&display=swap`;\n          document.head.appendChild(link);\n          loadedFontFamilies.current.add(familyKey);\n        }\n\n        // Apply font family to element inline for preview\n        element.style.fontFamily = `'${fontFamily}', sans-serif`;\n        return;\n      }\n\n      // Handle scroll messages from parent\n      if (e.data.msg === \"SCROLL\" && \"dx\" in e.data && \"dy\" in e.data) {\n        window.scrollBy(e.data.dx, e.data.dy);\n      }\n\n      // Handle visual edit mode state changes\n      if (e.data.msg === \"VISUAL_EDIT_MODE\" && \"active\" in e.data) {\n        const newMode = e.data.active;\n        setIsVisualEditMode(newMode);\n\n        // Clear localStorage if visual edit mode is being turned off\n        if (!newMode && typeof window !== \"undefined\") {\n          localStorage.removeItem(VISUAL_EDIT_MODE_KEY);\n          localStorage.removeItem(FOCUSED_ELEMENT_KEY);\n        }\n\n        // Send acknowledgement back to parent so it knows we received the mode change\n        window.parent.postMessage(\n          { type: CHANNEL, msg: \"VISUAL_EDIT_MODE_ACK\", active: newMode },\n          \"*\"\n        );\n\n        if (!newMode) {\n          // already handled, flush too\n          // Flush image src change for current focus\n          flushImageSrcChange();\n\n          // Clean up any editing element\n          cleanupEditingElement();\n\n          // Clear image element reference\n          focusedImageElementRef.current = null;\n\n          // Clear everything when exiting visual edit mode\n          setHoverBox(null);\n          setHoverBoxes([]);\n          setFocusBox(null);\n          setFocusedElementId(null);\n          lastHitElementRef.current = null;\n          focusedElementRef.current = null;\n          hasStyleChangesRef.current = false;\n\n          setHoverTag(null);\n          setFocusTag(null);\n\n          // Notify parent that we've cleared the selection\n          const msg: ChildToParent = {\n            type: CHANNEL,\n            msg: \"HIT\",\n            id: null,\n            tag: null,\n            rect: null,\n          };\n          postMessageDedup(msg);\n        }\n      }\n\n      // Handle clear inline styles message\n      if (e.data.msg === \"CLEAR_INLINE_STYLES\" && \"elementId\" in e.data) {\n        // Find ALL elements with the same orchids ID\n        const allMatchingElements = document.querySelectorAll(\n          `[data-orchids-id=\"${e.data.elementId}\"]`\n        ) as NodeListOf<HTMLElement>;\n\n        allMatchingElements.forEach((element) => {\n          // Clear only the inline styles we track (typography, spacing, and background)\n          const stylesToClear = [\n            \"fontSize\",\n            \"color\",\n            \"fontWeight\",\n            \"fontStyle\",\n            \"textDecoration\",\n            \"textAlign\",\n            \"paddingLeft\",\n            \"paddingRight\",\n            \"paddingTop\",\n            \"paddingBottom\",\n            \"marginLeft\",\n            \"marginRight\",\n            \"marginTop\",\n            \"marginBottom\",\n            \"backgroundColor\",\n            \"backgroundImage\",\n          ];\n\n          stylesToClear.forEach((prop) => {\n            (element.style as any)[prop] = \"\";\n          });\n        });\n\n        // Clear from our tracking\n        appliedStylesRef.current.delete(e.data.elementId);\n      }\n\n      // Handle show element hover message\n      if (e.data.msg === \"SHOW_ELEMENT_HOVER\" && \"elementId\" in e.data) {\n        const { elementId } = e.data;\n\n        if (!elementId) {\n          // Clear hover boxes if no element ID\n          setHoverBoxes([]);\n          setHoverTag(null);\n          return;\n        }\n\n        // Find ALL elements with the same orchids ID\n        const allMatchingElements = document.querySelectorAll(\n          `[data-orchids-id=\"${elementId}\"]`\n        ) as NodeListOf<HTMLElement>;\n\n        if (allMatchingElements.length > 0) {\n          const boxes: Box[] = [];\n          let tagName = \"\";\n\n          allMatchingElements.forEach((element) => {\n            // Skip if this element is the focused one\n            if (element === focusedElementRef.current) {\n              return;\n            }\n\n            const rect = element.getBoundingClientRect();\n            boxes.push(expandBox(rect));\n\n            if (!tagName) {\n              tagName =\n                element.getAttribute(\"data-orchids-name\") ||\n                element.tagName.toLowerCase();\n            }\n          });\n\n          // Set hover boxes for all matching elements\n          setHoverBoxes(boxes);\n          setHoverTag(boxes.length > 0 ? tagName : null);\n        }\n      }\n    }\n\n    // Handle scroll events to update hover box position\n    function onScroll() {\n      if (isResizingRef.current) return;\n      // Only update hover box if visual edit mode is active\n      if (!isVisualEditModeRef.current) return;\n\n      // Hide hover boxes while scrolling\n      setIsScrolling(true);\n      setHoverBox(null);\n      setHoverBoxes([]);\n\n      // Notify parent that scrolling has started\n      const scrollMsg: ChildToParent = {\n        type: CHANNEL,\n        msg: \"SCROLL_STARTED\",\n      };\n      postMessageDedup(scrollMsg);\n\n      // Reset the notification flag after scrolling stops\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n      scrollTimeoutRef.current = window.setTimeout(() => {\n        setIsScrolling(false);\n        const scrollStopMsg: ChildToParent = {\n          type: CHANNEL,\n          msg: \"SCROLL_STOPPED\",\n        };\n        postMessageDedup(scrollStopMsg);\n      }, 16); // One frame (16ms) for instant restoration\n    }\n\n    // Add event listeners\n    document.addEventListener(\"pointermove\", onPointerMove, { passive: true });\n    document.addEventListener(\"pointerleave\", onPointerLeave);\n    document.addEventListener(\"mousedown\", onMouseDownCapture, {\n      capture: true,\n    });\n    document.addEventListener(\"click\", onClickCapture, { capture: true });\n    window.addEventListener(\"message\", onMsg);\n    window.addEventListener(\"scroll\", onScroll, true);\n\n    return () => {\n      document.removeEventListener(\"pointermove\", onPointerMove);\n      document.removeEventListener(\"pointerleave\", onPointerLeave);\n      document.removeEventListener(\"mousedown\", onMouseDownCapture, true);\n      document.removeEventListener(\"click\", onClickCapture, true);\n      window.removeEventListener(\"message\", onMsg);\n      window.removeEventListener(\"scroll\", onScroll, true);\n      if (scrollTimeoutRef.current) clearTimeout(scrollTimeoutRef.current);\n    };\n  }, [focusedElementId, isResizing]); // Added focusedElementId and isResizing as dependencies\n\n  return (\n    <>\n      {/* Hover box - shows on hover with blue overlay */}\n      {isVisualEditMode && !isResizing && (\n        <>\n          {/* Render all hover boxes for elements with same ID */}\n          {hoverBoxes\n            .filter((box): box is NonNullable<Box> => box !== null)\n            .map((box, index) => (\n              <div key={index}>\n                <div\n                  className=\"orchids-hover-box\"\n                  style={{\n                    zIndex: 100000,\n                    left: box.left,\n                    top: box.top,\n                    width: box.width,\n                    height: box.height,\n                  }}\n                />\n                {/* Tag label on each hover box */}\n                {hoverTag && (\n                  <div\n                    className=\"orchids-hover-tag\"\n                    style={{\n                      zIndex: 100001,\n                      left: box.left,\n                      top: box.top - 20,\n                    }}\n                  >\n                    {hoverTag}\n                  </div>\n                )}\n              </div>\n            ))}\n        </>\n      )}\n\n      {/* Focus box - shows on click with just border, no overlay */}\n      {isVisualEditMode && focusBox && (\n        <>\n          {focusTag && (\n            <div\n              className=\"orchids-focus-tag\"\n              style={{\n                zIndex: 100003,\n                left: focusBox.left - 4,\n                top: focusBox.top - 16,\n              }}\n            >\n              {focusTag}\n            </div>\n          )}\n\n          <div\n            className=\"orchids-focus-box\"\n            style={{\n              zIndex: 100001,\n              left: focusBox.left,\n              top: focusBox.top,\n              width: focusBox.width,\n              height: focusBox.height,\n            }}\n          />\n\n          {/* Resize handles */}\n          {!isResizing && (\n            <>\n              {/* Corner handles */}\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-nw resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left - 4,\n                  top: focusBox.top - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"nw\")}\n              />\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-ne resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left + focusBox.width - 4,\n                  top: focusBox.top - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"ne\")}\n              />\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-sw resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left - 4,\n                  top: focusBox.top + focusBox.height - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"sw\")}\n              />\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-se resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left + focusBox.width - 4,\n                  top: focusBox.top + focusBox.height - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"se\")}\n              />\n\n              {/* Edge handles */}\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-n resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left + focusBox.width / 2 - 4,\n                  top: focusBox.top - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"n\")}\n              />\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-s resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left + focusBox.width / 2 - 4,\n                  top: focusBox.top + focusBox.height - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"s\")}\n              />\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-w resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left - 4,\n                  top: focusBox.top + focusBox.height / 2 - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"w\")}\n              />\n              <div\n                className=\"orchids-resize-handle orchids-resize-handle-e resize-handle\"\n                style={{\n                  zIndex: 100002,\n                  left: focusBox.left + focusBox.width - 4,\n                  top: focusBox.top + focusBox.height / 2 - 4,\n                }}\n                onMouseDown={(e) => handleResizeStart(e, \"e\")}\n              />\n            </>\n          )}\n        </>\n      )}\n    </>\n  );\n}\n\n"],"mappings":"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","names":["handle","msg"]}